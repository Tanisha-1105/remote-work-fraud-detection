<!--employee_report.html-->
{% extends "base.html" %}

{% block title %}Activity Report - {{ employee.name }}{% endblock %}

{% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('admin_dashboard') }}">
            <div class="brand-icon admin me-2"><i class="bi bi-shield-lock-fill"></i></div>
            <span class="fw-bold">TrueLensAI</span>
            <span class="text-light opacity-50 ms-2 small">/ Employee Activity Report</span>
        </a>
        <div class="d-flex align-items-center">
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-light btn-sm me-3"><i class="bi bi-arrow-left me-1"></i>Back to Dashboard</a>
            <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-light btn-sm"><i class="bi bi-box-arrow-right me-1"></i>Logout</a>
        </div>
    </div>
</nav>

<div class="container-fluid py-4 bg-light min-vh-100">
    {% if not employee %}
    <div class="alert alert-danger">Employee not found.</div>
    {% else %}
    <h3 class="mb-3">Activity Report for: {{ employee.name }} <span class="badge bg-secondary ms-2">{{ employee.role|capitalize }}</span></h3>
    <p class="text-muted">
        Email: {{ employee.email }} | 
        Employee ID: #{{ employee.id }} | 
        Department: {{ employee.department }} | 
        Shift: {{ employee.shift_time }}
    </p>

    <div class="card mb-4">
        <div class="card-header bg-warning-subtle d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-dark"><i class="bi bi-exclamation-triangle-fill me-2"></i> Current Risk Snapshot</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <p class="text-muted small mb-1">Latest Risk Score</p>
                    <h2 class="mb-0 text-{{ 'danger' if risk_summary.risk_score >= 80 else 'warning' if risk_summary.risk_score >= 50 else 'success' }}">
                        {{ risk_summary.risk_score|round(0) }}%
                    </h2>
                    <small class="text-muted">Level: {{ risk_summary.alert_level }}</small>
                </div>
                <div class="col-md-9 border-start">
                    <p class="text-muted small mb-1">Primary Risk Factors Detected (based on last 10 logs):</p>
                    {% if risk_summary.factors %}
                    <ul class="list-unstyled mb-0">
                        {% for factor in risk_summary.factors %}
                        <li class="small mb-1">
                            <span class="badge bg-{{ 'danger' if factor.severity == 'high' else 'warning' }} me-2">{{ factor.type }}</span>
                            {{ factor.description }}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="small text-success mb-0">No immediate high-risk factors detected in recent activity.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-white">
            <h5 class="mb-0">Detailed Activity Log (Last {{ activity_data|length }} Entries)</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 15%;">Timestamp</th>
                        <th style="width: 35%;">Active Window Title</th>
                        <th>Mouse</th>
                        <th>Keyboard</th>
                        <th>Idle (s)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in activity_data %}
                    <tr>
                        <td><small>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</small></td>
                        <td><small class="text-truncate" style="max-width: 250px;">{{ log.active_window_title or 'N/A' }}</small></td>
                        <td>{{ log.mouse_activity }}</td>
                        <td>{{ log.keyboard_activity }}</td>
                        <td><span class="text-{{ 'danger' if log.idle_time >= 30 else 'warning' if log.idle_time >= 15 else 'success' }} fw-bold">{{ log.idle_time|round(0) }}</span></td>
                        <td><span class="badge bg-{{ 'danger' if log.idle_time >= 30 else 'success' }}">{{ 'Idle' if log.idle_time >= 30 else 'Active' }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if not activity_data %}
        <div class="card-body text-center text-muted">No activity logs found for this employee.</div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}